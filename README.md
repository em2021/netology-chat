# **Курсовой проект "Сетевой чат"**

Проект состоит из двух приложений:
1. [Сервер](https://github.com/em2021/netology-chat/tree/main/netology-chat-clientapp)
2. [Клиент](https://github.com/em2021/netology-chat/tree/main/netology-chat-clientapp)

## Сервер

Включает 5 классов:
### 1. Main
Находит директорию и файл настроек, откуда считывает номер порта.  
После чего, запускает сервер на заданном порту.

### 2. Server
Принимает новые соединения и передает их в пул потоков в виде объектов класса *UserThread*.

### 3. UserThread
Выполняет функцию адаптера между клиентом и экземпляром класса *ChatBox*.  
Имплементирует интерфейсы *Runnable* и *Consumer*.  

В методе **run()**:
- отправляет пользователю сообщение
- получает его имя и проверяет на валидность
- если имя подходит, получает экземпляр класса *ChatBox*, вызывает у него метод **join()** и передает ссылку на самого себя 

Помимо **run()** cодержит методы:  
**disconnect()** - закрывает соединение  
**writeToUser()** - пишет в выходной поток сообщение пользователю  
**listen()** - принимает строки из входного потока  
**accept()** - имплементирует интерфейс *Consumer* - передает полученную строку в метод **writeToUser()**  
**setUserName()** - устанавливает имя пользователя  
**getUserName** - возращает имя пользователя  

### 4. ChatBox
Основной класс чата.  
Создан по шаблону *Singleton*.  
Содержит потокобезопасную Map, где хранит ссылки на потоки участников чата.  
Добавляет и удаляет пользователей, и диспетчерирует сообщения между всеми участниками чата.  
Логирует все сообщения в файл.  
При создании экземпляра класса также инициализирует создание экземпляра класаа *Logger*.  

Содержит методы:  
**getInstance()** - запускает **initLogFiles()**, получает экземпляр класса *Logger*, и возвращает экземпляр класса  
**initLogFiles()** - инициализирует создание директории и файла для логирования сообщений  
**join()** - проверяет, что в чате нет пользователя с таким именем, и добавляет нового пользователя в чат  
**exit()** - удаляет пользователя из чата и сообщает о его уходе оставшимся  
**formatMessage()** - форматирует сообщение для отправки - добавляет время, имя пользователя и *CRLF*  
**sendMessage()** - отправляет сообщение всем пользователям, если в чате только один пользователь - сообщает ему об этом  
**sendPrivateMessage()** - отправляет сообщение одному пользователю  
**notifyAllMembers()** - рассылает уведомление всем пользователям  
**notifyMembersExcept()** - рассылает уведомление всем пользователям кроме одного  

### 5. Logger
Логирует сообщения в указанный файл.  
Создан по шаблону Singleton.

## Клиент

Включает 2 класса:  

### 1. Main
Содержит основную логику взаимодействия с сервером.  

В методе main():  
- инициализирует получение настроек и подключение к серверу  
- при успещном подключении запускает 2 потока в пуле потоков:  

    1. Обрабатывает входной поток соединеня
        - пишет входящие сообщения в консоль
        - при запросе имени будит поток обработки выходного потока данных
        - при сообщении о том, что имя уже занято вызывает метод **resetUserName()**
        - логирует входящие сообщения

    2. Обрабатывает выходной поток соединения
        - передает сообщения в выходной поток
        - ждет пока не будет запрошено имя пользователя
        - при запросе - передает в выходной поток
        - если появляется запрос на переустановку имени - ожидает пока имя не будет переустановлено, а после отправляет

Содержит методы:  
**init()** - запускает поиск директории и файла настроек, откуда считывает номер порта и адрес сервера  
**getSettings()** - получает из файла настроек значение порта или адреса сервера  
**initLogFiles()** - инициализирует создание директории и файла для логирования сообщений   
**requestUserName()** - запрашивает пользователя ввести свое имя и возвращает его  
**setUserName()** - устанавливает имя пользователя  
**resetUserName()** - переустанавливает имя пользователя  

### 2. Logger
Логирует сообщения в указанный файл.  
Создан по шаблону Singleton.